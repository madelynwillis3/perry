---
title: "AQP_test"
author: "Madelyn Willis"
date: "`r Sys.Date()`"
output: html_document
---

```{r Library Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#remove pound symbols below if not yet installed 
#install.packages("aqp") 
#install.packages("soilDB")
library(aqp)
library(soilDB)
library(dplyr)
library(tidyr)

```


```{r Data Frame}
# template data:
horizon_data <- data.frame(
  id = c("Profile1", "Profile1", "Profile2", "Profile2"),
  top = c(0, 20, 0, 30),
  bottom = c(20, 50, 30, 60),
  texture = c("loam", "clay", "sandy_loam", "clay_loam"),
  pH = c(6.5, 5.8, 6.8, 6.0),
  clay = c(20, 40, 15, 30),
  silt = c(40, 30, 20, 25),
  sand = c(40, 30, 65, 45)
)
# Load libraries
library(aqp)
library(tidyr)
library(dplyr)

# Load Perry data
fp_data <- read.csv("../Data/Perry Full-Profile SampleData.csv", header = TRUE, sep = ",")

# Clean up fp_data
fp_clean <- fp_data[, c(
  "Point", "Sample.ID.Lab", "Horizon", "Potential.Series..in.progress.",
  "H.Depth.cm.", "Boundary..Bnd.", "Matrix.Color",
  "Lab.Texture..LPSA..preliminary.", "Field.Texture", "Field.Clay..",
  "Structure", "Consistence", "Depth.to.water.table..if.known."
)]

# Ensure H.Depth.cm. is numeric
fp_clean$H.Depth.cm. <- as.numeric(fp_clean$H.Depth.cm.)

# Calculate top and bottom depths from H.Depth.cm.
fp_clean <- fp_clean %>%
  group_by(Point) %>%  # Group by profile (Point)
  mutate(
    top = lag(cumsum(H.Depth.cm.), default = 0),  # Cumulative sum for top
    bottom = cumsum(H.Depth.cm.)                 # Cumulative sum for bottom
  ) %>%
  ungroup()
# Remove rows where 'Horizon' or 'Matrix.Color' is an empty string
fp_clean <- fp_clean %>%
  filter(Horizon != "" & Matrix.Color != "")



# Load texture data
texture_data <- read.csv("../Data/Perry_fp_texture_01_27_2025.csv", 
                         header = TRUE, sep = ",")
# Rename columns and clean texture data
colnames(texture_data) <- c("Point", "Sample", "Sand", "Clay", "Silt", 
                            "sand", "clay", "silt", "Abbr", "Texture")
texture_clean <- texture_data[, c("Point", "Sample", "sand", "clay", "silt")]
colnames(texture_clean) <- c("Point", "id", "sand", "clay", "silt")

# Remove letters from `id` and convert to numeric
texture_clean$id <- as.numeric(gsub("[A-Za-z]+$", "", texture_clean$id))

# Remove rows with missing values in 'sand', 'silt', or 'clay'
# Remove rows where 'sand', 'silt', or 'clay' is an empty string
texture_clean <- texture_clean %>%
  filter(sand != "" & silt != "" & clay != "")


# Create a new data frame using relevant data from both fp_clean and texture_clean
pedon_data <- fp_clean %>%
  select(Point, Horizon, Matrix.Color, Structure, Consistence) %>%
  left_join(texture_clean %>% select(Point, id, sand, silt, clay), by = "Point")

# View the new dataframe
head(pedon_data)

# Create a SoilProfileCollection using H.Depth.cm.
#depths(horizon_data_clean) <- Point ~ top + bottom

# Optional: Inspect the resulting SoilProfileCollection
#spc <- horizon_data_clean


```
```{r Soil Series Match}

```

